<!doctype html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Quên mật khẩu</title>
  <link rel="stylesheet"
        href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css"
        integrity="sha512-Kc323vGBEqzTmouAECnVceyQqyqdsSiqLQISBL29aUW4U/M7pSPA/gEUZQqv1cwx4OnYxTxve5UMg5GT6L4JJg=="
        crossorigin="anonymous" referrerpolicy="no-referrer"/>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
        rel="stylesheet"
        integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH"
        crossorigin="anonymous">
  <link rel="stylesheet"
        href="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.css"
        integrity="sha512-vKMx8UnXk60zUwyUnUPM3HbQo8QfmNx7+ltw8Pm5zLusl1XIfwcxo8DbWCqMGKaWeNxWA8yrx5v3SaVpMvR3CA=="
        crossorigin="anonymous" referrerpolicy="no-referrer"/>

  <link rel="stylesheet" href="/admin-assets/plugins/select2/css/select2.min.css"/>
  <link rel="stylesheet" href="/admin-assets/dist/css/style.css">

  <link rel="stylesheet" th:href="@{/web-assets/css/style.css}">
</head>
<body>
<header class="bg-dark">
  <nav class="navbar navbar-expand-lg">
    <div class="container">
      <a class="navbar-brand" href="/">
        <img src="https://motchilltv.io/logo_motchill.png" alt="" class="logo">
      </a>
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse"
              data-bs-target="#navbarNavAltMarkup"
              aria-controls="navbarNavAltMarkup" aria-expanded="false"
              aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse justify-content-between" id="navbarNavAltMarkup">
        <div class="navbar-nav">
          <a class="nav-link text-white" href="/">Trang chủ</a>
          <a class="nav-link text-white" href="/phim-bo">Phim bộ</a>
          <a class="nav-link text-white" href="/phim-le">Phim lẻ</a>
          <a class="nav-link text-white" href="/phim-chieu-rap">Phim chiếu rạp</a>
          <a class="nav-link text-white" href="#">Quốc gia</a>
          <a class="nav-link text-white" href="#">Thể loại</a>
        </div>

        <div>
          <a class="text-white" href="#">Đăng nhập</a>
        </div>
      </div>
    </div>
  </nav>
</header>

<section class="py-4">
  <div class="container">
    <div th:if="${!response.isSuccess}" class="d-flex justify-content-center align-items-center flex-column">Bạn không thể đổi mật khẩu</div>
    <div th:if="${response.isSuccess}" class="d-flex justify-content-center align-items-center flex-column">
      <h3 class="mb-3">Quên Mật Khẩu</h3>
      <form id="form-reset-password" class="p-4 bg-body-tertiary">
        <div class="mb-3 form-group">
          <label for="passwordNew" class="form-label">Mật Khẩu Mới</label>
          <input type="password" class="form-control" id="passwordNew" name="passwordNew"/>
        </div>
        <div class="mb-3 form-group">
          <label for="confirmPassword" class="form-label">Xác Nhận Mật Khẩu</label>
          <input type="password" class="form-control" id="confirmPassword" name="confirmPassword"/>
        </div>

        <div class="d-flex justify-content-between align-items-center mb-3">
          <button type="submit" class="btn btn-primary" id="btn-reset-password">Xác Nhận</button>
        </div>
      </form>
    </div>
  </div>
</section>

<footer class="py-4 bg-dark">
  <div class="container">
    <div class="row">
      <div class="col-4">
        <img src="https://motchilltv.io/logo_motchill.png" alt="" class="logo">
        <p class="text-white mt-3">Motchill - Xem phim Online Vietsub chất lượng cao miễn phí, nhiều
          thể loại
          phim phong phú, đặc sắc, giao diện trực quan, thuận tiện, tốc độ tải nhanh, thường xuyên
          cập nhật
          các bộ phim mới.</p>
      </div>
      <div class="col">
        <div class="text-white">
          <h5 class="text-uppercase mb-3 fw-normal">Danh mục</h5>
          <p>Tin tức</p>
          <p>Phim chiếu rạp</p>
          <p>Phim lẻ</p>
          <p>Phim bộ</p>
          <p>TV Show</p>
        </div>
      </div>
      <div class="col">
        <div class="text-white">
          <h5 class="text-uppercase mb-3 fw-normal">Danh mục</h5>
          <p>Tin tức</p>
          <p>Phim chiếu rạp</p>
          <p>Phim lẻ</p>
          <p>Phim bộ</p>
          <p>TV Show</p>
        </div>
      </div>
      <div class="col">
        <div class="text-white">
          <h5 class="text-uppercase mb-3 fw-normal">Danh mục</h5>
          <p>Tin tức</p>
          <p>Phim chiếu rạp</p>
          <p>Phim lẻ</p>
          <p>Phim bộ</p>
          <p>TV Show</p>
        </div>
      </div>
      <div class="col">
        <div class="text-white">
          <h5 class="text-uppercase mb-3 fw-normal">Danh mục</h5>
          <p>Tin tức</p>
          <p>Phim chiếu rạp</p>
          <p>Phim lẻ</p>
          <p>Phim bộ</p>
          <p>TV Show</p>
        </div>
      </div>
    </div>
  </div>
</footer>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js"
        integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g=="
        crossorigin="anonymous" referrerpolicy="no-referrer"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
        crossorigin="anonymous"></script>
<script src="https://unpkg.com/axios/dist/axios.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.js"
        integrity="sha512-VEd+nq25CkR676O+pLBnDW09R7VQX9Mdiij052gVCp5yVH3jGtH70Ho/UUv4mJDsEdTvqRCFZg0NKGiojGnUCw=="
        crossorigin="anonymous" referrerpolicy="no-referrer"></script>

<script src="/admin-assets/plugins/jquery-validation/jquery.validate.min.js"></script>
<script src="/admin-assets/plugins/jquery-validation/additional-methods.min.js"></script>

<script th:src="@{/web-assets/js/main.js}"></script>

<script th:inline="javascript">
  let token = [[${token}]];
</script>

<script>
  const formResetPasswordEL = document.getElementById("form-rest-password");
  const passwordNewEL = document.getElementById("passwordNew");
  const passwordConfirmEL = document.getElementById("confirmPassword");

  formResetPasswordEL.addEventListener('submit', async (e) => {
    e.preventDefault();

    $('#form-reset-password').validate({
      rules: {
        passwordNew: {
          required: true,
          minlength: 3
        },
        confirmPassword: {
          required: true,
          equalTo: "#passwordNew"
        },
      },
      messages: {
        passwordNew: {
          required: "Mật khẩu mới không được để trống",
          minlength: "Mật khẩu phải có ít nhất 3 ký tự"

        },
        confirmPassword: {
          required: "Mật khẩu xác nhận không được để trống",
          equalTo: "Mật khẩu xác nhận không trùng với mật khẩu mới"
        },
      },
      errorElement: 'span',
      errorPlacement: function (error, element) {
        error.addClass('invalid-feedback');
        element.closest('.form-group').append(error);
      },
      highlight: function (element, errorClass, validClass) {
        $(element).addClass('is-invalid');
      },
      unhighlight: function (element, errorClass, validClass) {
        $(element).removeClass('is-invalid');
      }

    });

    const request = {
      token: token,
      password: passwordNewEL.value,
      confirmPassword: passwordConfirmEL.value
    }
    try {
      const res = await axios.post('/api/auth/reset-password', request);
      toastr.success("Đổi mật khẩu thành công!");
      setTimeout(() => {
        window.location.href = '/dang-nhap.html';
      }, 1000);
    } catch (e) {
      toastr.error(e.response.data.message);
    }
  });
</script>
</body>
</html>